qbs <- plays2017 %>%
group_by(passer_player_name) %>%
filter(!is.na(passer_player_name)) %>%
summarize(Count = n())
qbs
qbs[[1]][1]
qbr2017[qbr2017$short_name == qbs[[1]][1] & qbr2017$week_text == "Week 1", 11][[1]][1]
qbs[[1]][1]
library(vroom)
data <- vroom("https://github.com/cadentwebb/football/blob/main/ESPN%20QBR%20(2017-2018)/2017-2018%20Weekly%20ESPN%20QBR.csv")
data <- vroom("https://raw.githubusercontent.com/cadentwebb/football/main/ESPN%20QBR%20(2017-2018)/2017-2018%20Weekly%20ESPN%20QBR.csv?token=ATH3CLAVYCCXCO6FKQMQD2LASVQJ6")
data
library(nflfastR)
library(tidyverse)
library(vroom)
# Get all pass and rush plays from first 6 weeks of 2017 season
databowlPlays2017 <- vroom("https://raw.githubusercontent.com/nfl-football-ops/Big-Data-Bowl/master/Data/plays.csv")
# Get all play by play data from 2017 season
pbpPlays2017 <- load_pbp(2017)
# Change column names in pbp to make it easily joinable to allPlays2017
colnames(pbpPlays2017)[3] <- "gameId"
colnames(pbpPlays2017)[1] <- "playId"
#Change gameId in pbp data to a double
pbpPlays2017$gameId <- as.double(pbpPlays2017$gameId)
# Join the datasets together
plays2017 <- inner_join(databowlPlays2017, pbpPlays2017,
by = c("gameId", "playId"))
# Decide which variables to keep. This gives us...
### Variables
# defenders in the box
# number of pass rushers
# personnel of defense
# play type
### Other information
# play description
# game ID
# play ID
plays2017 <- plays2017 %>%
select(gameId, playId, playDescription,
defendersInTheBox, numberOfPassRushers,
personnel.defense, play_type,
passer_player_name) %>%
# Eliminate special teams plaeys - keep only runs and passes
filter(play_type %in% c("run", "pass"))
# Show how many plays each QB is the thrower in
plays2017 %>%
group_by(passer_player_name) %>%
filter(!is.na(passer_player_name)) %>%
summarize(n())
# Example of adding the QBR for Carson Palmer to plays2017
# First, get the data from Nate's file
qbr2017 <- vroom("https://raw.githubusercontent.com/cadentwebb/football/main/ESPN%20QBR%20(2017-2018)/2017-2018%20Weekly%20ESPN%20QBR.csv?token=ATH3CLAVYCCXCO6FKQMQD2LASVQJ6")
# Create a qbr column initiated with all zeros
plays2017$qbr <- rep(0, dim(plays2017)[1])
qbs <- plays2017 %>%
group_by(passer_player_name) %>%
filter(!is.na(passer_player_name)) %>%
summarize(Count = n())
qbs[[1]][1]
for (i in qbs[[1]]) {
for (j in qbs[[1]]) {
if (i == j) {
plays2017$qbr[plays2017$passer_player_name, 9] <- qbr2017[qbr2017$short_name == i & qbr2017$week_text == "Week 1", 11][[1]][1]
}
}
}
k <- "C. Palmer"
qbs[[1]][1]
qbr2017[qbr2017$short_name == qbs[[1]][1] & qbr2017$week_text == "Week 1", 11][[1]][1]
# Search each play description for the string "C.Palmer" and return TRUE if
# it's found
# Then, add in Carson Palmer's week 1 rating of 35.6 to each of those columns
#qb <- "C.Palmer"
#for (i in 1:dim(plays2017)[1]) {
#  if (grepl(qb, plays2017[[3]][i])) {
#    plays2017$qbr[i] <- qbr2017[qbr2017$short_name == "C. Palmer" & qbr2017$week_text == "Week 1",
#        11][[1]][1]
#  }
#}
plays2017$passer_player_name
qbs[[1]][1]
plays2017$passer_player_name[1]
plays2017$passer_player_name[12]
plays2017$passer_player_name[11]
plays2017$passer_player_name[10]
plays2017$passer_player_name[9]
for (i in dim(plays2017)[1]) {
if (!is.na(plays2017$passer_player_name[i])) {
str_replace(plays2017$passer_player_name[i], ".", ". ")
}
}
qbs <- plays2017 %>%
group_by(passer_player_name) %>%
filter(!is.na(passer_player_name)) %>%
summarize(Count = n())
qbs
for (i in dim(plays2017)[1]) {
if (!is.na(plays2017$passer_player_name[i])) {
plays2017$passer_player_name[i] <- str_replace(plays2017$passer_player_name[i], ".", ". ")
}
}
qbs <- plays2017 %>%
group_by(passer_player_name) %>%
filter(!is.na(passer_player_name)) %>%
summarize(Count = n())
qbs
plays2017$passer_player_name[1]
str_replace(plays2017$passer_player_name[1], ".", ". ")
str_replace(plays2017$passer_player_name[1], "\\.", ". ")
for (i in dim(plays2017)[1]) {
if (!is.na(plays2017$passer_player_name[i])) {
plays2017$passer_player_name[i] <- str_replace(plays2017$passer_player_name[i], "\\.", ". ")
}
}
qbs <- plays2017 %>%
group_by(passer_player_name) %>%
filter(!is.na(passer_player_name)) %>%
summarize(Count = n())
qbs
plays2017$passer_player_name[1]
is.na(plays2017$passer_player_name[1])
!is.na(plays2017$passer_player_name[1])
plays2017$passer_player_name[1] <- str_replace(plays2017$passer_player_name[1], "\\.", ". ")
plays2017$passer_player_name[1]
plays2017$passer_player_name[2] <- str_replace(plays2017$passer_player_name[2], "\\.", ". ")
plays2017$passer_player_name[2]
plays2017$passer_player_name[3] <- str_replace(plays2017$passer_player_name[3], "\\.", ". ")
plays2017$passer_player_name[3]
dim(plays2017)[1]
for (i in 1:dim(plays2017)[1]) {
if (!is.na(plays2017$passer_player_name[i])) {
plays2017$passer_player_name[i] <- str_replace(plays2017$passer_player_name[i], "\\.", ". ")
}
}
plays2017$passer_player_name[12]
qbs <- plays2017 %>%
group_by(passer_player_name) %>%
filter(!is.na(passer_player_name)) %>%
summarize(Count = n())
qbs
library(nflfastR)
library(tidyverse)
library(vroom)
# Get all pass and rush plays from first 6 weeks of 2017 season
databowlPlays2017 <- vroom("https://raw.githubusercontent.com/nfl-football-ops/Big-Data-Bowl/master/Data/plays.csv")
# Get all play by play data from 2017 season
pbpPlays2017 <- load_pbp(2017)
# Change column names in pbp to make it easily joinable to allPlays2017
colnames(pbpPlays2017)[3] <- "gameId"
colnames(pbpPlays2017)[1] <- "playId"
#Change gameId in pbp data to a double
pbpPlays2017$gameId <- as.double(pbpPlays2017$gameId)
# Join the datasets together
plays2017 <- inner_join(databowlPlays2017, pbpPlays2017,
by = c("gameId", "playId"))
# Decide which variables to keep. This gives us...
### Variables
# defenders in the box
# number of pass rushers
# personnel of defense
# play type
### Other information
# play description
# game ID
# play ID
plays2017 <- plays2017 %>%
select(gameId, playId, playDescription,
defendersInTheBox, numberOfPassRushers,
personnel.defense, play_type,
passer_player_name) %>%
# Eliminate special teams plaeys - keep only runs and passes
filter(play_type %in% c("run", "pass"))
# Show how many plays each QB is the thrower in
plays2017 %>%
group_by(passer_player_name) %>%
filter(!is.na(passer_player_name)) %>%
summarize(n())
# Example of adding the QBR for Carson Palmer to plays2017
# First, get the data from Nate's file
qbr2017 <- vroom("https://raw.githubusercontent.com/cadentwebb/football/main/ESPN%20QBR%20(2017-2018)/2017-2018%20Weekly%20ESPN%20QBR.csv?token=ATH3CLAVYCCXCO6FKQMQD2LASVQJ6")
# Create a qbr column initiated with all zeros
plays2017$qbr <- rep(0, dim(plays2017)[1])
for (i in 1:dim(plays2017)[1]) {
if (!is.na(plays2017$passer_player_name[i])) {
plays2017$passer_player_name[i] <- str_replace(plays2017$passer_player_name[i], "\\.", ". ")
}
}
qbs <- plays2017 %>%
group_by(passer_player_name) %>%
filter(!is.na(passer_player_name)) %>%
summarize(Count = n())
for (i in qbs[[1]]) {
plays2017$qbr[plays2017$passer_player_name == i, 9] <- qbr2017[qbr2017$short_name == i & qbr2017$week_text == "Week 1", 11][[1]][1]
}
k <- "C. Palmer"
qbs[[1]][1]
qbr2017[qbr2017$short_name == qbs[[1]][1] & qbr2017$week_text == "Week 1", 11][[1]][1]
# Search each play description for the string "C.Palmer" and return TRUE if
# it's found
# Then, add in Carson Palmer's week 1 rating of 35.6 to each of those columns
#qb <- "C.Palmer"
#for (i in 1:dim(plays2017)[1]) {
#  if (grepl(qb, plays2017[[3]][i])) {
#    plays2017$qbr[i] <- qbr2017[qbr2017$short_name == "C. Palmer" & qbr2017$week_text == "Week 1",
#        11][[1]][1]
#  }
#}
qbs
for (i in qbs[[1]]) {
plays2017$qbr[plays2017$passer_player_name == i, 9] <- qbr2017[qbr2017$short_name == i & qbr2017$week_text == "Week 1", 11][[1]][1]
}
qbr2017[qbr2017$short_name == i & qbr2017$week_text == "Week 1", 11][[1]][1]
qbr2017[qbr2017$short_name == "A. Dalton" & qbr2017$week_text == "Week 1", 11][[1]][1]
qbr2017
qbr2017[, 12]
qbr2017[, 11]
qbr2017[, 11][[1]]
qbr2017[, 11][[1]][1]
qbr2017[qbr2017$short_name == "A. Dalton" & qbr2017$week_text == "Week 1", 11][[1]]
qbr2017[qbr2017$short_name == "C. Palmer" & qbr2017$week_text == "Week 1", 11][[1]]
qbr2017[qbr2017$short_name == "T. Brady" & qbr2017$week_text == "Week 1", 11][[1]]
view(qbr2017)
qbr2017 <- qbr2017 %>%
filter(season == 2017)
qbr2017[qbr2017$short_name == "T. Brady" & qbr2017$week_text == "Week 1", 11][[1]]
qbr2017[qbr2017$short_name == "T. Brady" & qbr2017$week_text == "Week 1", 11][[1]][1]
plays2017$qbr[plays2017$passer_player_name == "C. Palmer", 9]
plays2017$qbr[plays2017$passer_player_name == "C. Palmer", ]
plays2017[plays2017$passer_player_name == "C. Palmer", ]
plays2017[plays2017$passer_player_name == "C. Palmer", 9]
for (i in qbs[[1]]) {
plays2017[plays2017$passer_player_name == i, 9] <- qbr2017[qbr2017$short_name == i & qbr2017$week_text == "Week 1", 11][[1]][1]
}
for (i in qbs[[1]]) {
if (!is.na(plays2017[plays2017$passer_player_name == i, 9])) {
plays2017[plays2017$passer_player_name == i, 9] <- qbr2017[qbr2017$short_name == i & qbr2017$week_text == "Week 1", 11][[1]][1]
}
}
!is.na(plays2017[plays2017$passer_player_name == i, 9]
!is.na(plays2017[plays2017$passer_player_name == i, 9])
!is.na(plays2017[plays2017$passer_player_name == i, 9][1])
!is.na(plays2017[plays2017$passer_player_name == i, 9][[1]][1])
!is.na(plays2017[plays2017$passer_player_name == "C. Palmer", 9][[1]][1])
!is.na(plays2017[plays2017$passer_player_name == "C. Palmer", 9][[1]])
plays2017[plays2017$passer_player_name == "C. Palmer", 9][[1]]
plays2017$passer_player_name
plays2017[plays2017$passer_player_name == "C. Wents", 9][[1]]
plays2017[plays2017$passer_player_name == "C. Wentz", 9][[1]]
plays2017$passer_player_name == "C. Wentz"
length(plays2017[plays2017$passer_player_name == "C. Palmer", 9][[1]])
for (i in qbs[[1]]) {
for (j in length(plays2017[plays2017$passer_player_name == i, 9][[1]])) {
if (!is.na(plays2017[plays2017$passer_player_name == i, 9][[1]][j])) {
plays2017[plays2017$passer_player_name == i, 9][[1]][j] <- qbr2017[qbr2017$short_name == i & qbr2017$week_text == "Week 1", 11][[1]][1]
}
}
}
plays2017[plays2017$passer_player_name == i, 9][[1]][2]
plays2017[plays2017$passer_player_name == i, 9][[1]][1]
plays2017[plays2017$passer_player_name == i, 9][[1]][34]
plays2017[plays2017$passer_player_name == i, 9][[1]]
plays2017$qbr
plays2017
plays2017[2, 9]
plays2017[plays2017$passer_player_name == "C. Palmer", 9]
# Create a qbr column initiated with all zeros
plays2017$qbr <- rep(0, dim(plays2017)[1])
plays2017[plays2017$passer_player_name == "C. Palmer", 9]
plays2017[plays2017$passer_player_name == "C. Palmer", 9]
plays2017$qbr[2]
plays2017$qbr[1:10]
plays2017[plays2017$passer_player_name == "C. Palmer", ]
plays2017 <- plays2017 %>%
select(gameId, playId, playDescription,
defendersInTheBox, numberOfPassRushers,
personnel.defense, play_type,
passer_player_name) %>%
# Eliminate special teams plaeys - keep only runs and passes
filter(play_type %in% c("run", "pass"))
plays2017
plays2017[plays2017$play_type == "pass" & plays2017$passer_player_name == "C. Palmer", ]
plays2017[plays2017$play_type == "pass" & plays2017$passer_player_name == "C. Palmer", 9]
plays2017[plays2017$play_type == "pass" & plays2017$passer_player_name == "C. Palmer", 8]
# Create a qbr column initiated with all zeros
plays2017$qbr <- rep(0, dim(plays2017)[1])
plays2017[plays2017$play_type == "pass" & plays2017$passer_player_name == "C. Palmer", 9]
for (i in qbs[[1]]) {
for (j in length(plays2017[plays2017$passer_player_name == i, 9][[1]])) {
if (!is.na(plays2017[plays2017$passer_player_name == i, 9][[1]][j])) {
plays2017[plays2017$play_type == "pass" & plays2017$passer_player_name == i, 9][[1]][j] <- qbr2017[qbr2017$short_name == i & qbr2017$week_text == "Week 1", 11][[1]][1]
}
}
}
plays2017$qbr
plays2017[plays2017$play_type == "pass" & plays2017$passer_player_name == i, 9][[1]][1]
plays2017[plays2017$play_type == "pass" & plays2017$passer_player_name == i, 9][[1]][2]
length(plays2017[plays2017$passer_player_name == i, 9][[1]]
length(plays2017[plays2017$passer_player_name == i, 9][[1]])
dim(plays2017[plays2017$passer_player_name == i, 9][[1]])
dim(plays2017[plays2017$passer_player_name == i, 9])
dim(plays2017[plays2017$passer_player_name == i, 9])[1]
dim(plays2017[plays2017$play_type == "pass" & plays2017$passer_player_name == i, 9])[1]
for (i in qbs[[1]]) {
for (j in dim(plays2017[plays2017$play_type == "pass" & plays2017$passer_player_name == i, 9])[1]) {
plays2017[plays2017$play_type == "pass" & plays2017$passer_player_name == i, 9][[1]][j] <- qbr2017[qbr2017$short_name == i & qbr2017$week_text == "Week 1", 11][[1]][1]
}
}
plays2017$qbr
plays2017[plays2017$play_type == "pass" & plays2017$passer_player_name == i, 9][[1]][2]
plays2017[plays2017$play_type == "pass" & plays2017$passer_player_name == i, 9][[1]][2] <- 12
plays2017[plays2017$play_type == "pass" & plays2017$passer_player_name == i, 9][[1]][2]
qbr2017[qbr2017$short_name == i & qbr2017$week_text == "Week 1", 11][[1]][1]
j
plays2017[plays2017$play_type == "pass" & plays2017$passer_player_name == i, 9][[1]]
for (i in qbs[[1]]) {
for (j in 1:dim(plays2017[plays2017$play_type == "pass" & plays2017$passer_player_name == i, 9])[1]) {
plays2017[plays2017$play_type == "pass" & plays2017$passer_player_name == i, 9][[1]][j] <- qbr2017[qbr2017$short_name == i & qbr2017$week_text == "Week 1", 11][[1]][1]
}
}
plays2017$qbr
plays2017[plays2017$play_type == "pass" & plays2017$passer_player_name == "C. Wentz", 9][[1]][2]
qbr2017[qbr2017$short_name == "C. Wentz" & qbr2017$week_text == "Week 1", 11][[1]][1]
plays2017$qbr
plays2017[plays2017$play_type == "pass" & plays2017$passer_player_name == "T. Brady", 9]
plays2017
write.csv(plays2017, "Testplays2017.csv")
pbpPlays2017
plays2017 <- plays2017 %>%
select(gameId, playId, week, playDescription,
defendersInTheBox, numberOfPassRushers,
personnel.defense, play_type,
passer_player_name) %>%
# Eliminate special teams plaeys - keep only runs and passes
filter(play_type %in% c("run", "pass"))
# Join the datasets together
plays2017 <- inner_join(databowlPlays2017, pbpPlays2017,
by = c("gameId", "playId"))
plays2017 <- plays2017 %>%
select(gameId, playId, week, playDescription,
defendersInTheBox, numberOfPassRushers,
personnel.defense, play_type,
passer_player_name) %>%
# Eliminate special teams plaeys - keep only runs and passes
filter(play_type %in% c("run", "pass"))
# Get only 2017 season
qbr2017 <- qbr2017 %>%
filter(season == 2017)
str_c("Week ", 1)
dim(plays2017[plays2017$week == 1 & plays2017$play_type == "pass" & plays2017$passer_player_name == i, 9])[1]
plays2017
# Create a qbr column initiated with all zeros
plays2017$qbr <- rep(0, dim(plays2017)[1])
dim(plays2017[plays2017$week == 1 & plays2017$play_type == "pass" & plays2017$passer_player_name == i, 10])[1]
plays2017$week
plays2017$week == 1
dim(plays2017[plays2017$week == 1 & plays2017$play_type == "pass" & plays2017$passer_player_name == "C. Palmer", 10])[1]
dim(plays2017[plays2017$play_type == "pass" & plays2017$passer_player_name == "C. Palmer", 10])[1]
dim(plays2017[plays2017$play_type == "pass" & plays2017$passer_player_name == "C. Palmer", 10])
dim(plays2017[plays2017$play_type == "pass" & plays2017$passer_player_name == "C. Palmer", ])
plays2017
# Add a space to the QB name in the plays2017 dataset
for (i in 1:dim(plays2017)[1]) {
if (!is.na(plays2017$passer_player_name[i])) {
plays2017$passer_player_name[i] <- str_replace(plays2017$passer_player_name[i], "\\.", ". ")
}
}
dim(plays2017[plays2017$play_type == "pass" & plays2017$passer_player_name == "C. Palmer", ])
dim(plays2017[plays2017$week == 1 & plays2017$play_type == "pass" & plays2017$passer_player_name == "C. Palmer", ])
dim(plays2017[plays2017$week == 1 & plays2017$play_type == "pass" & plays2017$passer_player_name == "A. Dalton", ])
dim(plays2017[plays2017$week == 1 & plays2017$play_type == "pass" & plays2017$passer_player_name == "C. Wentz", ])
dim(plays2017[plays2017$week == 1 & plays2017$play_type == "pass" & plays2017$passer_player_name == "C. Wentz", 10])[1]
# Add Week 1 QBR to dataset
for (i in qbs[[1]]) {
for (j in 1:17) {
for (k in 1:dim(plays2017[plays2017$week == j & plays2017$play_type == "pass" & plays2017$passer_player_name == i, 10])[1]) {
plays2017[plays2017$week == j & plays2017$play_type == "pass" & plays2017$passer_player_name == i, 9][[1]][k] <- qbr2017[qbr2017$short_name == i & qbr2017$week_text == str_c("Week ", j), 11][[1]][1]
}
}
}
# Add Week 1 QBR to dataset
for (i in qbs[[1]]) {
for (j in 1:17) {
for (k in 1:dim(plays2017[plays2017$week == j & plays2017$play_type == "pass" & plays2017$passer_player_name == i, 10])[1]) {
plays2017[plays2017$week == j & plays2017$play_type == "pass" & plays2017$passer_player_name == i, 10][[1]][k] <- qbr2017[qbr2017$short_name == i & qbr2017$week_text == str_c("Week ", j), 11][[1]][1]
}
}
}
plays2017$qbr
plays2017[plays2017$week == 17 & plays2017$play_type == "pass" & plays2017$passer_player_name == "T. Brady", 10][[1]][2]
plays2017[plays2017$week == 17 & plays2017$play_type == "pass" & plays2017$passer_player_name == "T. Brady", 10][[1]]
plays2017[plays2017$week == 16 & plays2017$play_type == "pass" & plays2017$passer_player_name == "T. Brady", 10][[1]]
plays2017[plays2017$week == 15 & plays2017$play_type == "pass" & plays2017$passer_player_name == "T. Brady", 10][[1]]
plays2017[plays2017$week == 15 & plays2017$play_type == "pass" & plays2017$passer_player_name == "C. Palmer", 10][[1]]
plays2017$qbr
plays2017[plays2017$week == 15 & plays2017$play_type == "pass" & plays2017$passer_player_name == "C. Palmer", 10]
plays2017$qbr[1000]
write.csv(plays2017, "test.csv")
plays2017[plays2017$week == 5 & plays2017$play_type == "pass" & plays2017$passer_player_name == "C. Palmer", 10]
# Adding QBR to the dataset
library(nflfastR)
library(tidyverse)
library(vroom)
# Get all pass and rush plays from first 6 weeks of 2017 season
databowlPlays2017 <- vroom("https://raw.githubusercontent.com/nfl-football-ops/Big-Data-Bowl/master/Data/plays.csv")
# Get all play by play data from 2017 season
pbpPlays2017 <- load_pbp(2017)
pbpPlays2017
# Change column names in pbp to make it easily joinable to allPlays2017
colnames(pbpPlays2017)[3] <- "gameId"
colnames(pbpPlays2017)[1] <- "playId"
#Change gameId in pbp data to a double
pbpPlays2017$gameId <- as.double(pbpPlays2017$gameId)
# Join the datasets together
plays2017 <- inner_join(databowlPlays2017, pbpPlays2017,
by = c("gameId", "playId"))
# Decide which variables to keep. This gives us...
### Variables
# defenders in the box
# number of pass rushers
# personnel of defense
# play type
### Other information
# play description
# game ID
# play ID
# week
plays2017 <- plays2017 %>%
select(gameId, playId, week, playDescription,
defendersInTheBox, numberOfPassRushers,
personnel.defense, play_type,
passer_player_name) %>%
# Eliminate special teams plaeys - keep only runs and passes
filter(play_type %in% c("run", "pass"))
# Adding Weeks 1-6 QBR to dataset
# First, get the data from Nate's file
qbr2017 <- vroom("https://raw.githubusercontent.com/cadentwebb/football/main/ESPN%20QBR%20(2017-2018)/2017-2018%20Weekly%20ESPN%20QBR.csv?token=ATH3CLAVYCCXCO6FKQMQD2LASVQJ6")
# Get only 2017 season
qbr2017 <- qbr2017 %>%
filter(season == 2017)
# Add a space to the QB name in the plays2017 dataset
for (i in 1:dim(plays2017)[1]) {
if (!is.na(plays2017$passer_player_name[i])) {
plays2017$passer_player_name[i] <- str_replace(plays2017$passer_player_name[i], "\\.", ". ")
}
}
# Create a qbr column initiated with all zeros
plays2017$qbr <- ifelse(plays2017$play_type == "pass", 0, NA)
# Gather the QB names from plays 2017
qbs <- plays2017 %>%
group_by(passer_player_name) %>%
filter(!is.na(passer_player_name)) %>%
summarize(Count = n())
# Add Weeks 1-6 QBR for each QB to plays2017
for (i in qbs[[1]]) {
for (j in 1:6) {
for (k in 1:dim(plays2017[plays2017$week == j & plays2017$play_type == "pass" & plays2017$passer_player_name == i, 10])[1]) {
plays2017[plays2017$week == j & plays2017$play_type == "pass" & plays2017$passer_player_name == i, 10][[1]][k] <- qbr2017[qbr2017$short_name == i & qbr2017$week_text == str_c("Week ", j), 11][[1]][1]
}
}
}
# Adding Weeks 1-6 QBR to dataset
# First, get the data from Nate's file
qbr2017 <- vroom("https://raw.githubusercontent.com/cadentwebb/football/main/ESPN%20QBR%20(2017-2018)/2017-2018%20Weekly%20ESPN%20QBR.csv?token=ATH3CLAVYCCXCO6FKQMQD2LASVQJ6")
#initialize dataframe
weekly_qbr <- data.frame()
#loop throug seasons and weeks
for (i in 2017)
{
for (j in 1:17)
{
week <- espnscrapeR::get_nfl_qbr(season = i, week = j, season_type = "Regular")
qbr2017 <- weekly_qbr %>% rbind(week)
}
}
install.packages("espnscrapeR")
library(espnscrapeR)
install.packages("espnscrapeR")
install.packages("espnscrapeR")
qbr2017 <- vroom("https://raw.githubusercontent.com/cadentwebb/football/main/ESPN%20QBR%20(2017-2018)/2017-2018%20Weekly%20ESPN%20QBR.csv")
qbr2017 <- vroom("https://raw.githubusercontent.com/cadentwebb/football/main/ESPN%20QBR%20(2017-2018)/2017-2018%20Weekly%20ESPN%20QBR.csv?token=ATH3CLE44LHB7SRKOON2TN3ASWBCW")
# Create a qbr column initiated with all zeros
plays2017$qbr <- ifelse(plays2017$play_type == "pass", 0, NA)
# Add Weeks 1-6 QBR for each QB to plays2017
for (i in qbs[[1]]) {
for (j in 1:6) {
for (k in 1:dim(plays2017[plays2017$week == j & plays2017$play_type == "pass" & plays2017$passer_player_name == i, 10])[1]) {
plays2017[plays2017$week == j & plays2017$play_type == "pass" & plays2017$passer_player_name == i, 10][[1]][k] <- qbr2017[qbr2017$short_name == i & qbr2017$week_text == str_c("Week ", j), 11][[1]][1]
}
}
}
plays2017$qbr
# Get only 2017 season
qbr2017 <- qbr2017 %>%
filter(season == 2017)
# Get all pass and rush plays from first 6 weeks of 2017 season
databowlPlays2017 <- vroom("https://raw.githubusercontent.com/nfl-football-ops/Big-Data-Bowl/master/Data/plays.csv")
library(nflfastR)
library(tidyverse)
library(vroom)
# Get all pass and rush plays from first 6 weeks of 2017 season
databowlPlays2017 <- vroom("https://raw.githubusercontent.com/nfl-football-ops/Big-Data-Bowl/master/Data/plays.csv")
# Get all play by play data from 2017 season
pbpPlays2017 <- load_pbp(2017)
# Change column names in pbp to make it easily joinable to allPlays2017
colnames(pbpPlays2017)[3] <- "gameId"
colnames(pbpPlays2017)[1] <- "playId"
#Change gameId in pbp data to a double
pbpPlays2017$gameId <- as.double(pbpPlays2017$gameId)
# Join the datasets together
plays2017 <- inner_join(databowlPlays2017, pbpPlays2017,
by = c("gameId", "playId"))
write.csv(plays2017, "test.csv")
